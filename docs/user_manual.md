# TrueSight 用户手册

## 1. 系统概述

TrueSight是一个集成了网页爬取、内容预处理和RAGFlow知识库管理的一站式服务。系统可以从指定的起点网站进行树状深度爬取，保存为文本和PDF格式，计算Token数量，生成内容总结和问答对，并与RAGFlow无缝集成，实现知识库的自动化管理。

### 1.1 主要功能

- **网页爬取**：多线程并发爬取，树状深度探索，增量更新
- **内容预处理**：Token计算，LLM内容总结，问答对生成
- **RAGFlow集成**：自动创建Dataset，文档上传，解析触发，增删改查
- **信息库管理**：创建，配置，自动更新，批量操作
- **配置管理**：全局配置，信息库配置，文件类型映射

## 2. 安装与部署

### 2.1 系统要求

- **操作系统**：MacOS或Linux
- **Python版本**：3.9或更高
- **Node.js版本**：16.0或更高
- **浏览器**：Chrome, Firefox, Safari最新版

### 2.2 安装步骤

1. **克隆代码仓库**

```bash
git clone https://github.com/yourusername/TrueSight.git
cd TrueSight
```

2. **安装后端依赖**

```bash
cd backend
pip install -r requirements.txt
```

3. **安装前端依赖**

```bash
cd ../frontend
npm install
```

4. **配置环境变量**

创建`.env`文件在后端目录：

```
RAGFLOW_API_KEY=your_ragflow_api_key
RAGFLOW_BASE_URL=http://your_ragflow_server
LLM_API_KEY=your_llm_api_key
```

### 2.3 启动服务

1. **启动后端服务**

```bash
cd backend
python src/main.py
```

2. **启动前端服务**

```bash
cd frontend
npm start
```

3. **访问系统**

打开浏览器，访问 `http://localhost:3000`

## 3. 使用指南

### 3.1 创建信息库

1. 点击导航栏的"创建信息库"
2. 选择信息库类型：爬虫或上传
3. 对于爬虫类型：
   - 输入信息库名称
   - 输入起始URL（每行一个）
   - 设置爬取深度和并发线程数
   - 点击"开始爬取"
4. 对于上传类型：
   - 输入信息库名称
   - 上传文件或文件夹
   - 点击"创建信息库"

### 3.2 管理信息库

1. 在信息库列表页查看所有信息库
2. 点击信息库卡片进入详情页
3. 在详情页可以：
   - 查看基本信息和状态
   - 浏览原始文件、总结文件和问答文件
   - 计算Token、生成总结和问答对
   - 同步到RAGFlow

### 3.3 配置信息库

1. 在信息库详情页点击"设置"
2. 基本设置：
   - 修改描述和URL列表
   - 配置Embedding模型和分块方法
3. 自动更新：
   - 启用/禁用自动更新
   - 设置更新频率（每日/每周/每月/每年）
4. 直接入库：
   - 启用/禁用直接入库（跳过预处理）

### 3.4 批量操作

1. 在批量操作页面选择多个信息库
2. 可执行的批量操作：
   - 设置自动更新
   - 设置直接入库
   - 同步到RAGFlow

### 3.5 全局设置

1. 爬虫设置：
   - 最大爬取深度
   - 最大并发线程数
   - 请求超时时间
   - User Agent
2. 预处理设置：
   - LLM API密钥
   - LLM模型选择
3. RAGFlow设置：
   - RAGFlow基础URL
   - RAGFlow API密钥
   - 默认Embedding模型
   - 默认分块方法
   - 文件类型映射

## 4. 常见问题解答

### 4.1 爬虫相关

**Q: 爬取过程中可以暂停吗？**
A: 可以，在信息库详情页点击"暂停"按钮，之后可以点击"恢复"继续爬取。

**Q: 如何增量爬取？**
A: 系统会自动记录已爬取的URL，再次爬取同一网站时只会爬取新内容。

**Q: 爬取深度和并发线程数如何设置？**
A: 建议初次使用时设置深度为2-3，并发线程为5-10，根据实际情况调整。

### 4.2 预处理相关

**Q: Token计算需要多长时间？**
A: 取决于文件数量和大小，通常几秒到几分钟不等。

**Q: 生成总结和问答对需要LLM API密钥吗？**
A: 是的，需要在全局设置中配置有效的LLM API密钥。

**Q: 支持哪些文件格式？**
A: 目前支持.txt、.pdf和.html格式。

### 4.3 RAGFlow集成相关

**Q: 如何验证RAGFlow连接是否正常？**
A: 在全局设置页面保存RAGFlow配置后，系统会自动验证连接。

**Q: 文件同步到RAGFlow后如何查看？**
A: 可以直接访问RAGFlow管理界面查看已同步的Dataset和文档。

**Q: 如何处理同步失败的情况？**
A: 检查错误日志，确认RAGFlow服务是否正常，然后重试同步操作。

## 5. 最佳实践

1. **爬取策略**：
   - 从小规模开始，逐步增加爬取范围
   - 对于大型网站，建议分多个信息库爬取不同部分
   - 合理设置爬取深度，避免爬取过多无关内容

2. **预处理优化**：
   - 先计算Token再决定是否生成总结和问答对
   - 对于非常大的信息库，考虑使用直接入库功能
   - 根据内容类型选择合适的LLM模型

3. **RAGFlow集成**：
   - 为不同类型的内容创建不同的信息库
   - 合理配置文件类型映射，优化解析效果
   - 定期检查自动更新任务的执行状态

4. **系统维护**：
   - 定期检查错误日志
   - 对重要数据进行备份
   - 监控磁盘空间使用情况

## 6. 故障排除

1. **爬虫无法启动**：
   - 检查URL格式是否正确
   - 确认网络连接正常
   - 查看错误日志获取详细信息

2. **预处理失败**：
   - 验证LLM API密钥是否有效
   - 检查文件格式是否支持
   - 确认文件内容是否有效

3. **RAGFlow同步失败**：
   - 确认RAGFlow服务是否可访问
   - 验证API密钥是否正确
   - 检查文件是否符合RAGFlow要求

4. **自动更新未执行**：
   - 检查系统时间是否正确
   - 确认服务是否持续运行
   - 查看调度器日志

5. **系统性能问题**：
   - 减少并发爬取线程数
   - 优化文件存储结构
   - 增加服务器资源

## 7. 联系与支持

如有任何问题或需要技术支持，请联系：

- 邮箱：support@truesight.com
- 问题追踪：https://github.com/yourusername/TrueSight/issues
- 文档网站：https://truesight-docs.example.com
